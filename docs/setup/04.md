---
title: 
nav_order: 4
---

# サーバー環境の構築

## Backend Serverの環境を作る

前章で作成したOpenAPIを元に、以下のプロンプトを用いて、簡易的なBackendサーバを生成してみましょう。`.github/prompts/setup_backend_server.prompt.md`を作成し、会話で`/setup_backend_server`コマンドを実行してください。
このとき、OpenAPIの内容をコンテキストとして参照できるよう、チャット領域にファイルをドラッグ＆ドロップして追加しておくと良いです。

![](../assets/img/be_prompt.png)

???+ Example "プロンプト内容（.github/prompts/setup_backend_server.prompt.md）"

    ```markdown
    ---
    mode: agent
    ---

    あなたはバックエンド実装支援AIです。以下の固定スタック・出力形式・受け入れ基準に厳密に従って、
    私が提示する OpenAPI（または仕様）を満たす最小サーバを生成してください。

    # 固定スタック（毎回これで作る）

    - ランタイム: Node.js LTS（20 以上、22 推奨）
    - 言語: TypeScript
    - フレームワーク: Express 4.x
    - スキーマ/バリデーション: Zod
    - テスト: Jest + Supertest
    - 実行: ts-node-dev（開発）/ tsc でビルド → node（本番）
    - ポート: 3000（環境変数 PORT があれば優先）
    - 共通: /healthz で { ok: true }

    # 期待される成果物（ファイル構成と内容）

    - package.json（scriptsと依存は下記のとおり）
    - tsconfig.json（strict / outDir=dist / ES2020 / CommonJS）
    - jest.config.ts（ts-jest / roots=tests / collectCoverageFrom=src/\*_/_.ts）
    - src/server.ts（Express起動、/healthz、各APIルートの mount）
    - src/routes/\*\*.ts（各リソースのルーター）
    - src/schemas/\*\*.ts（Zod スキーマ：入力/出力/エラー）
    - tests/\*\*.test.ts（主要エンドポイントの Supertest）
    - 任意: src/lib/errors.ts（エラーハンドラ）, src/lib/repo.ts（インメモリ実装）

    # package.json（雛形）

    - scripts:
        - "dev": "ts-node-dev --respawn --transpile-only src/server.ts"
        - "build": "tsc --project tsconfig.json"
        - "start": "node dist/server.js"
        - "test": "jest"
    - dependencies: express, zod
    - devDependencies: typescript, ts-node-dev, jest, ts-jest, supertest,
      @types/express, @types/node, @types/jest, @types/supertest

    # 実装ルール

    - 仕様との契約（型・必須項目・長さ制約・ステータスコード）を **Zod** を使って厳密検証する
    - 400/404/500 を最低限実装。成功は 200/201/204 を使い分ける
    - エラーの JSON 形は { code: string, message: string, fieldErrors?: {field,msg}[] }
    - メモリDB（Map など）で十分。将来DBに差し替えやすい関数分割にする
    - ルートは /api をベースパスに揃える（例: /api/notes）
    - CORS は別オリジン想定があれば簡易許可（'\*'）をオプションで記述
    - OpenAPI を渡した場合は「どのエンドポイントがどの handler に対応するか」をコメントで明示
    - curl 検証コマンドを最後に列挙（成功/失敗パスの両方）
    - 余計な説明は短く。**コードを主**に出力する

    # 受け入れ基準（DoD）

    - `pnpm install` → `pnpm dev` で起動し、/healthz が 200 を返す
    - 主要な CRUD の happy path と 400/404 が Supertest で通る
    - curl コマンド例で手動確認ができる
    - 型エラー/実行時エラーなし（strict 準拠）

    # ここから対象仕様

    （※ここに OpenAPI または要件を貼る。無い場合は以下の簡易仕様を使う）

    - サンプル: Note API
        - GET /api/notes?q=
        - POST /api/notes {title[1..80], content[0..1000]}
        - GET /api/notes/:id
        - PATCH /api/notes/:id {title?, content?}
        - DELETE /api/notes/:id
        - スキーマ: {id, title, content, updatedAt: ISO8601}
        - ステータス: 200/201/204/400/404/500
    ```
